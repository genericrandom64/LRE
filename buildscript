#!/bin/bash

# output folders
mkdir -p bitcode
mkdir -p exec
mkdir -p obj

rm -r bitcode/*

for i in $(ls -d src/*/)
do
	if [[ -e $i/build ]]
	then
		
		echo "┌────────────────────────────────"
		echo "│ Building in $i..."
		echo "└────────────────────────────────"
		
		PTH=$(pwd); cd $i
		echo $PTH
		
		./build
		cd $PTH
	fi
done

echo "┌────────────────────────────────"
echo "│ Generating libraries..."
echo "└────────────────────────────────"

llvm-link -v bitcode/*.bc -o bitcode/lre.bc

llvm-link -v bitcode/*.bc -o obj/lre.o

echo "┌─────────────────┐"
echo "│ Build complete. │"
echo "└─────────────────┘"
